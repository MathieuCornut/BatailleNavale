{% extends 'base.html.twig' %}

{% block body %}
<div class="page-content"> 

    {% if info is defined %}
        {% if info.id == app.user.id %}
            {% set user = app.user %}
        {% else %}
            {% set user = info %}
        {% endif %}
    {% else %}
        {% if app.user is null %}
            Vous devez vous connecter <a href="{{path("app_login")}}"></a>
        {% else %}
            {% set user = app.user %}
        {% endif %}
    {% endif %}

    <h2><u>Votre profil</u></h2>
    <div class="row">
        <table>
            <tr>
                <th rowspan="4">
                    <img src="/images/user.png" class="profile_img">
                </th>
                <th><p>{{ user.pseudo }}</p></th>
            </tr>
            <tr>
                <td><p>Inscrit le {{ user.getRegistrationDate()|date("d/m/Y") }}</p></td>
            </tr>
            <tr>
                <td><p>Derni√®re connexion il y a {{user.lastLoginStr(user.lastLogin)}}</p></td>
            </tr>
            <tr>
                <td><p>Grade</p></td>
            </tr>
        </table>
    </div>

    <h2><u>Statistiques/Classement</u></h2>
    <h3><u>Statistiques</u></h3>
    <div class="row">
        <div id="parties" class="stats" classement ml-4>
            <span>Parties</span>
            <p>{{ user.countCombat }}</p>
        </div>
        <div id="victoires" class="stats" classement ml-4>
            <span>Victoires</span>
            <p>{{ user.countVictory }}</p>
        </div>
        <div id="ratio" class="stats" classement ml-4>
            <span>% de victoires</span>
            <p>{{ user.ratio(user.countCombat,user.countVictory) }}%</p>
        </div>
    </div>

    <h3><u>Classement</u></h3>
    <div class="row">
        <div id="classement_top" class="classement ml-6">
            <label>Top 5</label>
            {% dump(ranking) %}

            {% for player in ranking |slice(0, 5)%}
                {% if player.id == user.id %}
                    <p id="classement-position"><b>#{{loop.index}} - {{player.pseudo}} : {{player.count_victory}} victoires </b></p>                    
                {% else %}
                    <p>#{{loop.index}} - {{player.pseudo}} : {{player.count_victory}} victoires</p>
                {% endif %}
            {% endfor %}
        </div>
        <div id="classement_position" class="classement ml-6">
            <label>Votre position dans le classement</label>
            <p id="position"><b>#{{ user.position(user,ranking) }}</b></p>
            <a href="{{ path("ranking") }}">Tableau du classement</a>
        </div>
    </div>

    <h2><u>Historique de partie</u></h2>
    <div class="row">
        <p>// TODO, Objet Combat, boucle for de tous les combat ou joueur 1 ou 2 = id du joueur</p>
    </div>
</div>
{% endblock %}